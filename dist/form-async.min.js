/*! Form Async - v1.0.0 | (c) Form Async and other contributors */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){"use strict";function b(a,b){this.action=f.action(a),this.callbacks={before:h("before",b),error:h("error",b),success:h("success",b)},this.prototype={},this.elements=[],this.form=a,this.init()}function c(a){this.aborted=!1,this.options=a,this.attribute=a.attribute,this.callbacks=a.callbacks,this.context=a.context,this.state=a.state,this.init()}function d(b){var c="select, input, textarea, [contentEditable]";return 0===b.children.length&&a(b).is(c)?[b]:a(b).find(c).not(":submit, :reset, :image, :disabled, [data-disabled-autosave]")}var e=function(b){return a.async.data[b]},f={action:function(a){return a.getAttribute("action")||a.getAttribute("data-action")||null},group:function(a){var b=a.getAttribute("data-autosave-group");return b?b.replace(/\s/g,"").split(","):null},handler:function(a){return-1!==["checkbox","radio"].indexOf(this.type(a))||"select"===this.tag(a)?"change":"blur"},name:function(a){return a.getAttribute("name")||a.getAttribute("data-name")},state:function(a){return-1!==["checkbox","radio"].indexOf(this.type(a))?a.checked:a.value||a.innerHTML},tag:function(a){return a.tagName.toLowerCase()},type:function(a){return a.getAttribute("type")||null},value:function(b,c){return-1===["input","select","textarea"].indexOf(b.tag)||"checkbox"===b.type&&!c.checked?a(c).html():a(c).val()}},g=function(a){return"function"==typeof a&&"number"!=typeof a.nodeType},h=function(b,c){return g(c[b])?c[b]:a.async.defaults!==undefined&&g(a.async.defaults[b])?a.async.defaults[b]:function(){}};c.prototype={abort:function(){this.aborted=!0},init:function(){this.request={abort:this.abort.bind(this),action:this.options.action,data:this.options.data,attribute:{handler:this.attribute.handler,name:this.attribute.name,tag:this.attribute.tag,type:this.attribute.type}},this.callbacks.before.bind(this.context)(this.request),this.aborted||(delete this.request.abort,a.extend(this.request,{success:this.success.bind(this),error:this.error.bind(this),retry:this.call.bind(this)}),this.call())},call:function(){a.ajax({mode:"abort",method:"post",port:"async",url:this.request.action,data:this.request.data,success:this.success.bind(this),error:this.error.bind(this)})},success:function(b){a.data(this.context,e("state"),this.state),this.callbacks.success.bind(this.context)(b,this.request)},error:function(){this.callbacks.error.bind(this.context)(this.request)}},a.extend(b.prototype,{init:function(){var b=this;a.each(d(this.form),function(c,d){b.elements.push({selector:d,action:f.action(d),group:f.group(d),handler:f.handler(d),name:f.name(d),tag:f.tag(d),type:f.type(d)}),a(d).on(f.handler(d),b.save.bind(b)).data(e("elements"),b.elements.length-1).data(e("state"),f.state(d))})},save:function(b){var d=b.target,g=a.data(d,e("elements")),h=this.elements[g],i=f.state(d);if(a.data(d,e("state"))!==i)return new c({action:h.action||this.action,attribute:h,callbacks:this.callbacks,context:d,data:this.data(h,g),state:i})}}),a.extend(b.prototype,{data:function(b,c){var d,e={},g=this;return a.each(this.dependency(b,c),function(a,b){var c=g.elements[b],h=c.name,i=f.value(c,c.selector);"[]"===h.substr(-2)?(h=h.substr(0,h.length-2),e[h]=e[h]||[],""!==i&&e[h].push(i)):e[h]=i;for(d in e)e[d]instanceof Array&&0===e[d].length&&(e[d]="")}),e},dependency:function(a,b){return"checkbox"===a.type?this.find(this.elements,[a.name]):a.group?this.find(this.elements,a.group):[b]},find:function(b,c){var d=[];return a(b).each(function(a,b){-1!==c.indexOf(b.name)&&d.push(a)}),d}}),a.async={version:"1.0.0",data:{form:"async",elements:"async-element",state:"previous-state"}},a.fn.async=function(c){c=c||{},a(this).each(function(){return a(this).data(e("form"),new b(this,c))})}});
//# sourceMappingURL=form-async.min.map